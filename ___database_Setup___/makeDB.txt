CREATE DATABASE IF NOT EXISTS Users
CHARACTER SET utf8mb4
COLLATE utf8mb4_unicode_ci;

USE Users;

CREATE TABLE Departments (
    Id INT AUTO_INCREMENT PRIMARY KEY,
    Name VARCHAR(100) NOT NULL UNIQUE
);

CREATE TABLE Permissions (
    Id INT AUTO_INCREMENT PRIMARY KEY,
    Name VARCHAR(100) NOT NULL UNIQUE
);

CREATE TABLE Users (
    Id INT AUTO_INCREMENT PRIMARY KEY,
    UserName VARCHAR(50) NOT NULL UNIQUE,
    Email VARCHAR(100) NOT NULL UNIQUE,
    DepartmentId INT,
    IsActive BOOLEAN NOT NULL DEFAULT TRUE,
    IsSuperuser BOOLEAN NOT NULL DEFAULT FALSE,
    HashedPassword VARCHAR(255) NOT NULL,
    LastToken VARCHAR(255),
    FOREIGN KEY (DepartmentId) REFERENCES Departments(Id)
);

CREATE TABLE UserPermissions (
    UserId INT NOT NULL,
    PermissionId INT NOT NULL,
    PRIMARY KEY (UserId, PermissionId),
    FOREIGN KEY (UserId) REFERENCES Users(Id) ON DELETE CASCADE,
    FOREIGN KEY (PermissionId) REFERENCES Permissions(Id) ON DELETE CASCADE
);
